{% extends "Shared/_layout.twig" %}

{% block title %} Transactions {% endblock %}

{% block header_scripts %}
    <link href="/assets/components/toastr/toastr.min.css"  rel="stylesheet">
 {% endblock %}

{% block body %}
    
<!-- side nav menu -->
{# {% include 'Bookkeeping/_sidenav.twig' %} #}
{{ include('Bookkeeping/_sidenav.twig') }}

<!-- page content -->
<div class="container-fluid" id="transactions" v-cloak>
    
    <!-- csrf protection -->
    <input type="hidden" name="csrf" id="csrf" value="{{ csrf }}">

    <!-- page name and date selection -->
    <div class="row mb-2 pt-4">
        <div class="col-8 border-bottom">
            <h1 class="text-dark mb-4">Accounting Records</h1>        
        </div>    

        <!-- date selection -->
        <div class="col-2 border-bottom p-1">        
            <div class="input-group">                                       
                <input type="date" class="form-control" placeholder="date yyyy-mm-dd" aria-label="Start date" aria-describedby="button-addon4" v-model="start_date" v-on:change="onYearChange()">                   
            </div>               
        </div>           
        <div class="col-2 border-bottom p-1">        
            <div class="input-group">                                       
                <input type="date" class="form-control" placeholder="date yyyy-mm-dd" aria-label="End date" aria-describedby="button-addon4" v-model="end_date" v-on:change="onYearChange()">                   
            </div>               
        </div>           
    </div>             

    <!-- transaction totals -->
    <div class="row" v-if="action==''">
        <div class="col-12">         
            <h3 class="mt-3">Transaction Totals</h3>
        </div>
        
        <!-- Transaction totals -->
        <div class="col-3" v-if="odometer != false">
            <ul class="list-group">
                <li class="list-group-item d-flex justify-content-between align-items-center"><strong>Exprences Total</strong> </li>
                <li class="list-group-item d-flex justify-content-between align-items-center"><strong>Income Total</strong> </li>                         
            </ul>
        </div>       
        <div class="col-3" v-if="odometer != false">
            <ul class="list-group">
                <li class="list-group-item d-flex justify-content-between align-items-center"><strong>Feed Expences</strong> </li>
                <li class="list-group-item d-flex justify-content-between align-items-center"><strong>Cattle Purchace Expences</strong></li>              
            </ul>
        </div>     
            <div class="col-3" v-if="odometer != false">
            <ul class="list-group">
                <li class="list-group-item d-flex justify-content-between align-items-center"><strong>Veterinary </strong> </li>
                <li class="list-group-item d-flex justify-content-between align-items-center"><strong>Other</strong></li>              
            </ul>
        </div>       
    </div>
   

    <!-- header and search form inputs -->
    <div class="row g-0 mt-5" v-if="action==''">
        <div class="col-3">
             <h3>Transactions
                <a href="#" v-on:click="setAction('new')">
                    <i class="far fa-plus-square btn-sm text-success align-middle"
                        data-bs-toggle="tooltip" data-bs-placement="top" title="Add transaction"></i>
                </a>                 
            </h3>
        </div>
         <!-- transaction category and other search parameters -->
        <div class="col-2">
            <select class="form-select w-100 rounded-0" aria-label="Select group" v-model="transaction_category_selected" v-on:change="categoryChanged()">
                <option v-for="item in transaction_category" v-bind:value="item.id">
                    {{ '{{ item.category_name }}' }}
                </option>            
            </select>
        </div>
        <div class="col-2">
            <select class="form-select w-100 rounded-0" aria-label="Select sub group" v-bind:disabled="transaction_sub_category_disabled">
                <option v-for="item in transaction_sub_category" v-bind:value="item.id">
                    {{ '{{ item.category_name }}' }}
                </option>            
            </select>
        </div>
        <div class="col-2 pe-2">
            <div class="has-search rounded-0 w-100">
                <span class="fa fa-search form-control-feedback"></span>
                <input type="text" class="form-control w-100"  placeholder="Search" v-model="search_term" v-on:keyup="goSearch()">
            </div>
        </div>
    </div>


    <!-- new transaction form -->
    <div class="row ms-1" v-if="action=='new' || action=='edit'">
        <div class="col-2 px-0">
            <input type="text" class="form-control mx-0" placeholder="Name" aria-label="Name" v-model="transaction_record.trans_name" required>
        </div>
        <div class="col-3 px-0">
            <input type="text" class="form-control mx-0" placeholder="Description" aria-label="Name" v-model="transaction_record.trans_desc" required>
        </div>
        <div class="col-2 px-0">
            <input type="text" class="form-control mx-0" placeholder="Place Name" aria-label="Name" v-model="transaction_record.trans_address_name" required>
        </div>
        <div class="col-2 px-0">
            <input type="text" class="form-control mx-0" placeholder="Address" aria-label="Price" v-model="transaction_record.trans_address" required>                                
        </div>
        <div class="col-1 px-0">
            <input class="form-control mx-0" type="date" aria-label="Start date" v-model="transaction_record.trans_date">
        </div>
        <div class="col-2 px-0">
            <button class="btn btn-warning rounded-0" type="button" v-on:click="setAction('')">
                <i class="fas fa-times-circle text-small mr-1"></i>
                Cancel           
            </button>                  
            <button class="btn btn-success rounded-0" type="button" v-on:click="transactionAdd" v-if="action == 'new'">
                <i class="far fa-plus-square btn-sm text-white ps-0" title="Add starting finance point"></i>
                Save           
            </button>  
              <button class="btn btn-success rounded-0" type="button" v-on:click="transactionEdit" v-if="action=='edit'">
                <i class="far fa-plus-square btn-sm text-white ps-0" title="Add starting finance point"></i>
                Update           
            </button>                                          
        </div>
    </div>   
   
   <!-- transaction display table and delete modal -->
    <div class="row mt-2">
        <div class="col-9">            
        
            <table class="table table-sm bg-white table-borderless shadow-sm table-hover w-100">                
                <thead class="table-dark">
                    <tr>                           
                        <th scope="col"  class="w-75">Name</th>                                  
                        <th scope="col"  class="w-10">$ CAD</th>     
                        <th scope="col" class="w-10">#</th>                                            
                    </tr>
                </thead>
                <tbody v-for="(item, index) in transactions">
                    <tr class="border">                     
                        <td class="ps-4" v-bind:class="item.class">
                            <div>{{ '{{item.trans_name}}' }}</div>
                            
                            <a href="#" v-on:click="showItemForm(true)" class="mt-0 text-dark">
                                <i class="far fa-plus-square btn-sm text-success me-1 mt-0"
                                    data-bs-toggle="tooltip" data-bs-placement="top" title="Add transaction item">
                                </i>
                                <small>Add Item</small>
                            </a>                            
                            {# <p><small>{{ '{{item.trans_desc}}' }}</small></p> #}
                        </td>                                                      
                        <td v-bind:class="item.class">${{ '{{item.trans_ammount}}' }} </td>
                        <td class="pt-1">                      
                            <a href="#" v-on:click.prevent="delOneShow(item.id, item.trans_name)">
                                <i class="far fa-trash-alt btn-sm text-danger align-middle float-right"
                                    data-toggle="tooltip" data-placement="top" title="remove transaction"></i>
                            </a>
                                <a href="#" v-on:click="editShow(index)">
                                <i class="fa fa-edit btn-sm text-warning align-middle pe-0 float-right"
                                    data-toggle="tooltip" data-placement="top" title="edit transaction"></i>
                            </a>
                            <a href="#">
                                <i data-toggle="tooltip" data-placement="top" title="View transaction" class="far fa-eye text-small text-info float-right ms-2"></i>
                            </a>
                        </td>
                    </tr>    
                    <tr v-if="item.is_edit == true">
                        <td colspan="4">
                                <div class="input-group">
                                <input type="hidden" v-model="project_item_edit.id" />
                                <input type="text" class="form-control col-6" placeholder="Project name" aria-label="Project name" aria-describedby="button-addon4" v-model="project_item_edit.project_name" required>
                                <input type="text" class="form-control col-2" placeholder="Projected expence" aria-label="Projected expence" aria-describedby="button-addon4" v-model="project_item_edit.project_price" required>
                                <input type="text" class="form-control col-2" placeholder="Actual expence" aria-label="Actual expence" aria-describedby="button-addon4" v-model="project_item_edit.project_price_actual" required>
                                <input type="date" class="form-control col-2" placeholder="date yyyy-mm-dd" aria-label="Start date" aria-describedby="button-addon4" v-model="project_item_edit.created_at">
                                <div class="input-group-append" id="button-addon4">     
                                    <a href="#" class="btn btn-warning" v-on:click="setAction('')">
                                        <i class="fas fa-times-circle text-small mr-1"></i>
                                        Cancel           
                                    </a>                  
                                    <a href="#" class="btn btn-success" v-on:click="editOne()">
                                        <i class="fas fa-check btn-sm text-white ps-0" title="Save item update"></i>
                                        Save           
                                    </a>                       
                                </div>
                            </div>
                        </td>
                    </tr>                       
                </tbody>
            </table>
        </div>
        
        <!-- new or edit form -->
        <div class="col-3 mt-0" v-if="action=='new' || action=='edit'">
            <div class="card col-12 bg-dark text-white rounded shadow-sm">
                <h5 class="mt-3 mb-1 ms-3">
                    <span v-if="action=='new'">New</span>
                    <span v-if="action=='edit'">Edit</span>
                    Transaction
                </h5>
                <hr class="bg-secondary" />
                <form class="mt-0 mb-3 mx-3">                  
                    <div class="col">
                        <label for="trans_name">Transaction Name </label><small class="text-danger float-end"> (required *)</small>
                        <input type="text" class="form-control bg-secondary text-white border-dark" id="trans_name" aria-describedby="trans_name" v-model="transaction_record.trans_name" required>
                        <small id="emailHelp" class="form-text text-muted float-end">50 characters max</small>
                    </div>
                    <div class="col mt-4">
                        <label for="trans_desc">Description</label>
                        <input type="text" class="form-control bg-secondary text-white border-dark" id="trans_desc" aria-describedby="trans_desc" v-model="transaction_record.trans_desc" required>
                        <small id="cat_desc_warrning" class="form-text text-muted float-end">250 characters max</small>
                    </div>    
                    <div class="col mt-4">
                        <label for="trans_category">Category</label>
                        <select class="form-select w-100 rounded-0 bg-secondary text-white border-dark" aria-label="Select group" v-model="transaction_category_selected" v-on:change="categoryChanged()" id="trans_category">
                            <option v-for="item in transaction_category" v-bind:value="item.id">
                                {{ '{{ item.category_name }}' }}
                            </option>            
                        </select>
                    </div> 
                    <div class="col mt-4">  
                         <label for="trans_subcategory">Sub Category</label>                  
                        <select class="form-select w-100 rounded-0 bg-secondary text-white border-dark" aria-label="Select sub group" v-bind:disabled="transaction_sub_category_disabled" id="tans_subcategory">
                            <option v-for="item in transaction_sub_category" v-bind:value="item.id">
                                {{ '{{ item.category_name }}' }}
                            </option>            
                        </select>
                    </div>                       
                    <div class="clearfix mt-3"></div>              
                    <div class="col mt-3 d-flex justify-content-end">                                   
                        <a href="#" class="btn btn-warning rounded-0" v-on:click="setAction('')">
                            <i class="fas fa-times-circle text-small me-1"></i>
                            Cancel           
                        </a>    
                        <a href="#" class="btn btn-success rounded-0" v-on:click="saveCategory" v-if="action=='edit'">
                            <i class="fas fa-check btn-sm text-white ps-0" title="Save item update"></i>
                            Update           
                        </a>                                                     
                        <a href="#" class="btn btn-success rounded-0" v-on:click="saveCategory" v-if="action=='new'">
                            <i class="fas fa-check btn-sm text-white ps-0" title="Save item update"></i>
                            Save           
                        </a>               
                    </div>
                </form>
            </div> 
        </div>  

        <!-- Remove transaction Modal -->
        <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header bg-danger">
                        <h5 class="modal-title text-white" id="exampleModalCenterTitle">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Remove item
                        </h5>     
                        {# <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>             #}
                    </div>
                    <div class="modal-body">
                        Are you sure you want to remove transaction record for <b>"{{ '{{ transaction_record.trans_name }}' }}"</b> ?
                        <div class="alert alert-warning mt-2" role="alert">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Please be advised removing transaction will remove all it's sub items as well including any saved photocopy.
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-warning" data-dismiss="modal" v-on:click.prevent="delOneHide()">
                            <i class="fas fa-times-circle text-small me-1"></i>Cancel
                        </button>
                        <button type="button" class="btn btn-danger" v-on:click.prevent="delTransactionMain()">
                            <i class="far fa-trash-alt text-small me-1"></i>Remove</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- end of modal -->
 
    </div>  
</div>

{% endblock %}

{% block custom_scripts %}

    <script src="/assets/js/vue.global.prod.js"></script>
    <script src="/assets/components/toastr/toastr.min.js"></script>

    <script src="/assets/js/vue/accounting/transactions/index.js"></script>


     <script type="application/javascript">
        $(function () {
            $('[data-bs-toggle="tooltip"]').tooltip();
        });
    </script>

{% endblock %}